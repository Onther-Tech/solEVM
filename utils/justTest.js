const web3 = require('web3');
const OP = require('./constants');
const utils = require('ethereumjs-util');
const BN = utils.BN;
const ethers = require('ethers');


const code = '6080604052600436106100295760003560e01c806395fe0e651461002e578063db3297f614610069575b600080fd5b34801561003a57600080fd5b506100676004803603602081101561005157600080fd5b8101908080359060200190929190505050610097565b005b6100956004803603602081101561007f57600080fd5b8101908080359060200190929190505050610155565b005b6000816040516100a690610215565b80828152602001915050604051809103906000f0801580156100cc573d6000803e3d6000fd5b5090508073ffffffffffffffffffffffffffffffffffffffff16630c55699c6040518163ffffffff1660e01b815260040160206040518083038186803b15801561011557600080fd5b505afa158015610129573d6000803e3d6000fd5b505050506040513d602081101561013f57600080fd5b8101908080519060200190929190505050505050565b6000348260405161016590610215565b808281526020019150506040518091039082f090508015801561018c573d6000803e3d6000fd5b5090508073ffffffffffffffffffffffffffffffffffffffff16630c55699c6040518163ffffffff1660e01b815260040160206040518083038186803b1580156101d557600080fd5b505afa1580156101e9573d6000803e3d6000fd5b505050506040513d60208110156101ff57600080fd5b8101908080519060200190929190505050505050565b60d1806102228339019056fe60806040526040516100d13803806100d183398181016040526020811015602557600080fd5b8101908080519060200190929190505050806000819055505060858061004c6000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c80630c55699c14602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000548156fea26469706673582212202160bff1c71533d9cb776348c69f48ff0add8fadb88bae7fae9764f318c0951364736f6c63430006020033a2646970667358221220c8e882771ef3a0794ae4ca475700f841402e6e2f400bf36f247b69e593d6c87d64736f6c63430006020033';
const data = '0xdb3297f6000000000000000000000000000000000000000000000000000000000000000a';
const tStorage = [];

const accounts = [
  // caller
  {
    address: '0x9069B7d897B6f66332D15821aD2f95609c81E59a',
    code: code,
    tStorage: tStorage,
    nonce: new BN(0x2, 16),
    balance: new BN(0x64, 16),
    storageRoot: OP.ZERO_HASH,
    codeHash: OP.ZERO_HASH
  },
];

const generateAddress = utils.generateAddress(accounts[0].address, accounts[0].nonce)
console.log('generateAddress', generateAddress)

function generateAddr2 () {
    const bytecode = '0x608060405234801561001057600080fd5b506040516100df3803806100df8339818101604052602081101561003357600080fd5b8101908080519060200190929190505050806000819055505060858061005a6000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c80630c55699c14602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000548156fea26469706673582212200075a6935ae1a8e69cac7a8e97695ed5b5c681c3fb05f2c42f5b168b0aa15b7c64736f6c634300060600330000000000000000000000000000000000000000000000000000000000000001'
    const bytecodeHash = ethers.utils.solidityKeccak256(
        ['bytes'],
        [bytecode]
    );
    const hash = ethers.utils.solidityKeccak256(
      [
        'bytes1',
        'address',
        'bytes32',
        'bytes32'
      ], 
      [
        "0xff",
        '0x6674be3EdEf7eAafE791D28B2e8D85ca3d949732',
        '0x0000000000000000000000000000000000000000000000000000000000000000',
        bytecodeHash
      ]
    );
    
    return hash.slice(26);
  }

  console.log(generateAddr2());

const createAddr = utils.generateAddress2('0x9069B7d897B6f66332D15821aD2f95609c81E59a', '0x0000000000000000000000000000000000000000000000000000000000000001', '0x60806040526040516100d13803806100d183398181016040526020811015602557600080fd5b8101908080519060200190929190505050806000819055505060858061004c6000396000f3fe6080604052348015600f57600080fd5b506004361060285760003560e01c80630c55699c14602d575b600080fd5b60336049565b6040518082815260200191505060405180910390f35b6000548156fea2646970667358221220084bd8f97f4d5a652b73889570e925e9e235438d4d278444c991371d4cc9a36e64736f6c63430006060033000000000000000000000000000000000000000000000000000000000000000a')
console.log(createAddr);

console.log(web3.utils.soliditySha3('0x9157eC625C0A5Fc0A67125aF6f9aA14bDbF84D8D'));